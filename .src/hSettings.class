' Gambas class file

Private gridfile As String = FMain.Confpath & "/GridIndex.txt"


Public Sub Button1_Click()
    FMain.xb.register("show")
End

Public Sub init()
  GridIndex.Columns.count = 2
  GridIndex.Columns[0].Title = ("Depth")
  GridIndex.Columns[1].Title = ("Directory")
  GridIndex.Columns.w = -1
  LoadGrid()
End

Public Sub Button3_Click()
  If Dialog.SelectDirectory() Then Return
  GridIndex.Rows.count += 1
  GridIndex[GridIndex.Rows.max, 1].text = Dialog.Path
  GridIndex[GridIndex.Rows.max, 0].text = 5
  GridIndex.Columns.w = -1
  SaveGrid()
End


Public Sub GridIndex_Activate()
    GridIndex.Edit
End

Public Sub GridIndex_Save(Row As Integer, Column As Integer, Value As String)
  If column = 0 Then 
    Try GridIndex[row, column].text = CInt(value)
      Else
    GridIndex[row, column].text = value
  Endif
  SaveGrid()
End

Public Sub Button2_Click()
 GridIndex.Rows.Remove(GridIndex.row)
 SaveGrid()
End

Public Sub SaveGrid()
  Dim i As Integer
  Dim filedata As String
  Stop 
  For i = 0 To GridIndex.Rows.Max
    filedata &= GridIndex[i, 0].text & "\n"
    filedata &= GridIndex[i, 1].text & "\n"
  Next
  File.Save(gridfile, Trim(filedata))
End

Public Sub LoadGrid()
  Dim i As Integer
  Dim filedata, item, WhatToDo As String
  Try filedata = File.Load(gridfile)
  If Error Then Return
  WhatToDo = "getDepth"
  For Each item In Split(filedata, "\n", "", False)
    Select WhatToDo
      Case "getDepth"
        GridIndex.Rows.count += 1
        GridIndex[GridIndex.Rows.max, 0].text = item
        WhatToDo = "getDir"
      Case "getDir"
        GridIndex[GridIndex.Rows.max, 1].text = item
        WhatToDo = "getDepth"
    End Select
  Next
  
  For i = 0 To GridIndex.Rows.Max
    filedata &= GridIndex[i, 0].text & "\n"
    filedata &= GridIndex[i, 1].text & "\n"
  Next
End



Public Sub Button4_Click()
  FMain.indexer.reindex()
  Button4.enabled = False
  Repeat
    Wait 0.1
  Until FMain.indexer.indexing = False
  Button4.enabled = True
End

Public Sub Form_Close()
  FMain.show
End



Public Sub ValueBoxReindex_Change()

   Try FMain.indexer.restart_timer(MySettings.plugin_indexer_last_index_time, ValueBoxReindex.value)

End
