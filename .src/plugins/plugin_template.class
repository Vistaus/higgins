' Gambas class file

Create Static
Static Public Description As String = "Example plugin"
Static Public Friendly_name As String = "Example plugin"
Static Public configurable As Boolean = False 'does this plugin provides a configure() method?

Public Sub _free()

End


Public Struct rItemT
  plugin As String            'the plugin name
  Text As String              'text displayed in the clipboard
  SubText As String           'text displayed under the main text
  Image_file As String        'optional image displayed (fullpath or "DefferredMimeIcon")
  Clipboard_data As String    'the data copied to the clipboard
  Action As String            'string that indicates an action
  Action_p As Variant          'the parameter for Action
End Struct


Private textcontrol As Object
Private plugin As String
Private iconsize As Integer
Private minchar As Integer = 3   'exit if the search term is lower than that



Public Sub _new(p_plugin As String, p_iconsize As Integer)

  plugin = p_plugin
  iconsize = p_iconsize

End


Public Sub Stop()
  
  'not sure if this is the right way, but this should be called when the plugin has to be unloaded
  
End


Private Sub trigged(query As String) As Boolean
  If Len(query) < minchar Then Return False
  'some more controls here (?)
  Return True
End

' Editable part of the template follows:

Public Sub find(textcontrol As Object) As RItemT[]
  'search for filedialogs bookmarks
  Dim aFile As String
  Dim rResults As New RItemT[]
  Dim rResult As RItemT
  Dim current_search As String = textcontrol.text
  
  If Not trigged(textcontrol.text) Then Return
  
  For Each aFile In Dir(User.home).sort()
    
    rResult = create_item(aFile)
    If rResult <> Null Then rResults.Add(rResult)
    'Wait 'if calculations are heavy a wait may be handy.
    If textcontrol.text <> current_search Then Return


  Next 'aFile
  Return rResults

End


Private Function create_item(result As String) As RItemT
  Dim return_item As RItemT
  Dim hApp As DesktopApps
  return_item = New RItemT
  return_item.plugin = plugin
  return_item.Action = "DESKTOPOPEN" ' DESKTOPOPEN,EXEC,GUESS,NULL... MORE?
  return_item.Action_p = "/usr/bin/gambas3"
  return_item.Clipboard_data = "Some data copied to the clipboard"
  return_item.image_file = "icon:/" & iconsize & "/bookmark"
  return_item.Text = result
  return_item.SubText = "In: " & User.home
  Return return_item
End

Public Sub configure()
  
  'this starts the configuration window.
  
End
